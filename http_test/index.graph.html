<!DOCTYPE html>
<html>
  <head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <title>Test http push</title>
  </head>

  <body>
    <p>For user <span id="user">(?)</span> the count is <span id="count">(?)</span></p>

    <span id="ticker"">Loading..</span>


    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
    <script src="http://omnipotent.net/jquery.sparkline/2.1.1/jquery.sparkline.min.js"></script>
    <script src="http://localhost:8000/socket.io/socket.io.js"></script>
    <script>
      var socket = io.connect('http://localhost:8000/key-count');
      var userCounts = []

      socket.on('user update', function (data) {
        console.log(data);
        $('#user').text(data.user);
        $('#count').text(data.count);
        userCounts.push(data.count);
      });

      var updateSparkline = function (userCounts) {
          $('#ticker').sparkline(userCounts);
          setTimeout(function () {
            updateSparkline(userCounts);
          }, 1000);
        }
      $(document).ready(function () {
        updateSparkline(userCounts);
      });
    </script>
  </body>
</html>
